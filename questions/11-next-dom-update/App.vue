

<script setup>
import { ref, nextTick } from "vue";

const count = ref(0);
const counter = ref(null);

function increment() {
  count.value++;

  /**
   * DOM is not yet updated, how can we make sure that the DOM gets updated
   * Make the output be true
   *   
   * nextTickæ˜¯Vue.jsä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨ä¸‹ä¸€æ¬¡DOMæ›´æ–°åæ‰§è¡Œä¸€äº›ä»£ç ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„ä»£ç å’ŒDOMçš„çŠ¶æ€æ˜¯åŒæ­¥çš„ï¼Œé¿å…å‡ºç°ä¸€äº›é”™è¯¯æˆ–ä¸ä¸€è‡´çš„æƒ…å†µã€‚ğŸ‘

nextTickçš„ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯æœ‰ï¼š

å½“ä½ æƒ³è¦ä½¿ç”¨setTimeoutæ¥å»¶è¿Ÿä¸€äº›æ“ä½œï¼Œä½†æ˜¯ä¸ç¡®å®šå»¶è¿Ÿçš„æ—¶é—´æ˜¯å¦åˆé€‚ï¼Œä½ å¯ä»¥ä½¿ç”¨nextTickæ¥æ›¿ä»£ï¼Œå®ƒä¼šåœ¨æœ€åˆé€‚çš„æ—¶æœºæ‰§è¡Œä½ çš„ä»£ç ã€‚
å½“ä½ æƒ³è¦åœ¨æ•°æ®å˜åŒ–åå¯¹DOMè¿›è¡Œä¸€äº›æ“ä½œæˆ–æ£€æŸ¥ï¼Œæ¯”å¦‚è·å–å…ƒç´ çš„é«˜åº¦ã€å®½åº¦ã€ä½ç½®ç­‰ï¼Œä½ å¯ä»¥ä½¿ç”¨nextTickæ¥ä¿è¯DOMå·²ç»æ›´æ–°ï¼Œç„¶åå†è·å–æ­£ç¡®çš„å€¼ã€‚
å½“ä½ åœ¨è¿›è¡Œä¸€äº›å¼‚æ­¥çš„æ•°æ®åŠ è½½æˆ–å¤„ç†ï¼Œæ¯”å¦‚ä»APIè·å–æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨nextTickæ¥ç­‰å¾…æ•°æ®åŠ è½½å®Œæˆï¼Œç„¶åå†æ›´æ–°è§†å›¾æˆ–æ‰§è¡Œå…¶ä»–é€»è¾‘ã€‚
  */

  nextTick(() => {
    // +ä¸€å…ƒè¿ç®—ç¬¦, å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—
    console.log(+counter.value.textContent === 1);
  });
}
</script>

<template>
  <button ref="counter" @click="increment">
    {{ count }}
  </button>
</template>
